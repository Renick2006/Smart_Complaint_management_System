# dashboard.html

<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">
<div class="text-end mb-2">
    <a href="/logout" class="btn btn-outline-danger btn-sm">Logout</a>
</div>
 

<div class="container my-4" style="max-width: 1200px;">
    <h2 class="text-center mb-4">Admin Dashboard</h2>

    <!-- PIE CHARTS ROW -->
    <div class="row text-center mb-4">

        {% for category in ['Billing', 'Delivery', 'Product'] %}
        <div class="col-md-4">
            <div class="card shadow p-3">
                <h5>{{ category }} Complaints</h5>
                <canvas id="{{ category }}Chart" style="cursor:pointer;"></canvas>
            </div>
        </div>
        {% endfor %}

    </div>

    <!-- FILTERED COMPLAINTS -->
    <div class="card shadow">
        <div class="card-body">
            <h5 id="complaintTitle">Select a category to view complaints</h5>

            <table class="table table-striped mt-3" id="complaintTable" style="display:none;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Complaint</th>
                        <th>Urgency</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="complaintBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const complaints = {{ complaints | tojson }};
const stats = {{ stats | tojson }};

// Create pie charts
function createChart(category) {
    const ctx = document.getElementById(category + "Chart");

    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Resolved', 'Pending'],
            datasets: [{
                data: [
                    stats[category]?.Resolved || 0,
                    stats[category]?.Pending || 0
                ],
                backgroundColor: ['#198754', '#dc3545']
            }]
        },
        options: {
            onClick: () => filterComplaints(category)
        }
    });
}

['Billing', 'Delivery', 'Product'].forEach(createChart);

// Filter complaints on click
function filterComplaints(category) {
    const tbody = document.getElementById("complaintBody");
    tbody.innerHTML = "";

    const filtered = complaints.filter(c => c[2] === category);

    filtered.forEach(c => {
        tbody.innerHTML += `
            <tr>
                <td>${c[0]}</td>
                <td>${c[1]}</td>
                <td>${c[3]}</td>
                <td>${c[5]}</td>
            </tr>
        `;
    });

    document.getElementById("complaintTitle").innerText =
        `${category} Complaints (${filtered.length})`;

    document.getElementById("complaintTable").style.display = "table";
}
</script>

</body>
</html>
